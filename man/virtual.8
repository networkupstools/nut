.TH VIRTUAL 8 "Wed Jul 8 2009" "" "Network UPS Tools (NUT)"
.SH NAME
virtual \- UPS driver clone

.SH NOTE
This man page only documents the specific features of the
virtual driver.  For information about the core driver, see
\fBnutupsdrv\fR(8).

.SH DESCRIPTION
This driver, which sits on top of another driver socket, allows to group
clients to a particular outlet of a device and deal with this output as
if it was a normal UPS.

.SH EXTRA ARGUMENTS
This driver supports the following settings:

.IP "load.off=\fIcommand\fR"
Recommended.  Set the command on the 'real' UPS driver that will be used to
switch off the outlet.  You need both \fIload.off\fR and \fIload.on\fR in
order to power cycle the outlet.  Otherwise, shutting down the clients
powered by an outlet is a one way street (see \fBIMPORTANT\fR).

.IP "load.on=\fIcommand\fR"
Recommended.  Set the command on the 'real' UPS driver that will be used to
switch on the outlet.  You need both \fIload.off\fR and \fIload.on\fR in
order to power cycle the outlet.  Otherwise, shutting down the clients
powered by an outlet is a one way street (see \fBIMPORTANT\fR).

.IP "load.status=\fIvalue\fR"
Recommended.  Set the variable on the 'real' UPS driver that will be used
to indicate the outlet status (ie on/off).  If not specified, the virtual
driver will attempt to keep track of the outlet status, but this is less
reliable.

.IP "offdelay=\fInum\fR"
Set the timer (in seconds) before the outlet is turned off after the
shutdown condition (OB LB) for this outlet is met or a command to shutdown
was issued.  Defaults to 120 seconds.

.IP "ondelay=\fInum\fR"
Set the timer (in seconds) for the outlet to switch on in case the power
returns after the oulet has been switched off.  Defaults to 30 seconds.

.IP "mincharge=\fIvalue\fR"
Set the remaining battery level when the virtual UPS switches to LB
(percent).

.IP "minruntime=\fIvalue\fR"
Set the remaining battery runtime when the virtual UPS switches to LB
(seconds).

.SH IMPLEMENTATION
The port specification in the \fBups.conf\fR(5) reference the driver
socket that the 'real' UPS driver is using. For example:

.nf
[realups]
   driver = usbhid-ups
   port = auto
.fi

.nf
[virtual-outlet-1]
   driver = virtual
   port = usbhid-ups-realups
   load.on = outlet.1.load.on
   load.off = outlet.1.load.off
   load.status = outlet.1.status
   [...]
.fi

.SH IMPORTANT
Unlike a real UPS, you should \fBnot\fR configure a upsmon master for this
driver.  When a upsmon master sees the OB LB flags and tells the upsd server
it is OK to initiate the shutdown sequence, the server will latch the FSD
status and it will not be possible to restart the systems connected without
restarting the upsd server.

This will be a problem if the power returns after the virtual UPS initiated
the shutdown sequence on it's outlet, but returns before the real UPS begins
shutting down. The solution is in the virtual driver, that will insert the
FSD flag if needed without the help of a upsmon master.

.SH CAVEATS
The virtual UPS will follow the status on the real UPS driver.  You can only
make the virtual UPS shutdown earlier than the real UPS driver, not later.
If the real UPS driver initiates a shutdown, the virtual UPS driver will
immediately follow.

Be aware that the commands to shutdown/restart an outlet on the real UPS
drivers are not affected, so if you tell the real UPS driver to shutdown
the outlet of the virtual UPS driver, your clients will lose power without
warning.

.SH AUTHOR
Arjen de Korte <adkorte-guest@alioth.debian.org>

.SH SEE ALSO

\fBupscmd\fR(1),
\fBupsrw\fR(1),
\fBups.conf\fR(5),
\fBnutupsdrv\fR(8)

.SS Internet resources:
The NUT (Network UPS Tools) home page: http://www.networkupstools.org/
